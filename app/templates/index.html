{% extends "base.html" %}
{% block content %}

<section class="card">
  <h2>Upload Documents</h2>

  <label>Select S3 Folder</label>
  <select id="folderSelect"></select>

  <label>Choose .txt files</label>
  <input type="file" id="files" multiple accept=".txt">

  <button onclick="upload()" class="btn">Upload</button>
</section>

<section class="card">
  <h2>Ask the Knowledge Base</h2>
  <input id="q" placeholder="Enter your question" class="input">
  <button onclick="ask()" class="btn">Ask</button>

  <pre id="answer" class="answer"></pre>
</section>

<script>
  async function loadFolders() {
    const res = await fetch("/folders");
    const data = await res.json();
    const sel = document.getElementById("folderSelect");
    sel.innerHTML = "";
    data.folders.forEach(f => {
      const o = document.createElement("option");
      o.value = f;
      o.textContent = f;
      sel.appendChild(o);
    });
  }
  loadFolders();

  async function upload() {
    const fd = new FormData();
    fd.append("folder", document.getElementById("folderSelect").value);

    const files = document.getElementById("files").files;
    for (const f of files) fd.append("files", f);

    const res = await fetch("/upload", { method: "POST", body: fd });
    const t = await res.text();
    alert(t);
  }

  async function ask() {
    const q = document.getElementById("q").value;
    const res = await fetch("/ask", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ question: q })
    });

    const data = await res.json();
    document.getElementById("answer").innerText = data.answer;
  }
</script>

{% endblock %}
